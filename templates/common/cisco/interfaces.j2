{# templates/common/cisco/interfaces.j2 #}
{%- macro render_iface(interface) -%}
interface {{ interface.name }}
{% if interface.description %} description {{ interface.description }}{% endif %}

{%  for addr in interface.ip_addresses|map(attribute='address')|list %}
  ip address {{ addr.split('/')[0] }} {{ addr.split('/')[1]|int|cidr_to_netmask }}
{%  endfor %}

{% if interface.vrf %} vrf forwarding {{ interface.vrf.name }}{% endif %}

{# trunk / access logic #}
{% set allowed = interface.tagged_vlans|default([])|map(attribute='vid')|list %}
{% if allowed %}
  switchport mode trunk
  switchport trunk allowed vlan {{ allowed|join(',') }}
{% elif interface.untagged_vlan %}
  switchport mode access
  switchport access vlan {{ interface.untagged_vlan.vid }}
{% endif %}

{% if interface.enabled %} no shutdown{% else %} shutdown{% endif %}
{%- endmacro -%}
