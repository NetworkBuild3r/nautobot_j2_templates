{# common/cisco/interfaces.j2 #}
{% for iface in host.interfaces %}
interface {{ iface.name }}
{%   if iface.description %} description {{ iface.description }}{% endif %}

{%   if iface.ip_addresses %}
{%     for ip in iface.ip_addresses | map(attribute='address') %}
  ip address {{ ip.split('/')[0] }} {{ ip.split('/')[1] | int | cidr_to_netmask }}
{%     endfor %}
{%   endif %}

{%   if iface.vrf %} vrf forwarding {{ iface.vrf.name }}{% endif %}

{# ------- L2 configuration ------------------------------------ #}
{%   if iface.tagged_vlans %}
  switchport mode trunk
  switchport trunk allowed vlan {{
        iface.tagged_vlans
        | map(attribute='vid')
        | select
        | list
        | join(',')
  }}
{%   elif iface.untagged_vlan %}
  switchport mode access
  switchport access vlan {{ iface.untagged_vlan.vid }}
{%   endif %}

{%   if iface.enabled %} no shutdown{% else %} shutdown{% endif %}

{% endfor %}
