{% for interface in host.interfaces %}
interface {{ interface.name }}
  {%- if interface.tagged_vlans %}
  switchport mode trunk
  switchport trunk allowed vlan {{ interface.tagged_vlans | map(attribute='vid') | join(',') }}
  {%- elif interface.untagged_vlan %}
  switchport mode access
  switchport access vlan {{ interface.untagged_vlan.vid }}
  {# Add access-specific commands if role is Access #}
  {% if host.role.name | lower == 'access' %}
  spanning-tree portfast
  spanning-tree bpduguard enable
  {% endif %}
  {%- endif %}
  {%- if interface.description %}
  description {{ interface.description }}
  {%- endif %}
  {%- for addr in interface.ip_addresses %}
  ip address {{ addr.address.split('/')[0] }} {{ addr.address.split('/')[1] | int | cidr_to_netmask }}
  {%- endfor %}
  {%- if interface.enabled | default(false) %}
  no shutdown
  {%- else %}
  shutdown
  {%- endif %}
{% endfor %}