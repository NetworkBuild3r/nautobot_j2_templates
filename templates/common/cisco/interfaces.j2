! Interfaces
{% for interface in host.interfaces %}
interface {{ interface.name }}
{% if interface.description %}  description {{ interface.description }}{% endif %}

{#— IP address —#}
{% if interface.ip_addresses %}
  {% set addr = interface.ip_addresses[0].address %}
  ip address {{ addr.split('/')[0] }} {{ addr.split('/')[1] | int | prefix_to_netmask }}
{% endif %}

{#— VRF forwarding —#}
{% if interface.vrf is defined and interface.vrf.name is defined %}
  vrf forwarding {{ interface.vrf.name }}
{% endif %}

{#— Access VLAN —#}
{% if interface.untagged_vlan is defined and interface.untagged_vlan.vid is defined %}
  {% set uv = interface.untagged_vlan %}
  switchport mode access
  switchport access vlan {{ uv.vid }}
  {%- if uv.name is defined %}  description Access VLAN {{ uv.vid }} ({{ uv.name }}){% endif %}
{% endif %}

{#— Trunk VLANs —#}
{% if interface.tagged_vlans is defined and interface.tagged_vlans | length > 0 %}
  {% set trunk_vids = interface.tagged_vlans
       | selectattr('vid','defined')
       | map(attribute='vid')
       | list %}
  {% if trunk_vids %}
    switchport mode trunk
    switchport trunk allowed vlan {{ trunk_vids | join(',') }}
    {% set trunk_names = interface.tagged_vlans
         | selectattr('name','defined')
         | map(attribute='name')
         | list %}
    {%- if trunk_names %}  description Trunk VLANs: {{ trunk_names | join(', ') }}{% endif %}
  {% endif %}
{% endif %}

{#— Admin state —#}
{% if interface.enabled %}  no shutdown{% else %}  shutdown{% endif %}

{% endfor %}
