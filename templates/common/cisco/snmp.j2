!
{% for comm in host.config_context.cisco_snmp_ios.snmp.communities %}
snmp-server community {{
    comm.secret_group is defined and comm.secret_name is defined
    and (host.config_context.secrets_groups
           | selectattr("name","equalto",comm.secret_group)
           | first
           | get_secret_by_secret_group_name(comm.secret_name))
    or comm.name
}} {{ comm.permission }} {{ comm.timeout }}
{% endfor %}

snmp-server trap-source {{ host.config_context.cisco_snmp_ios.snmp.trap_source }}
snmp-server contact "{{ host.config_context.cisco_snmp_ios.snmp.contact }}"

{% for acl in ['51','60'] %}
ip access-list standard {{ acl }}
{% for rule in host.config_context.cisco_snmp_ios.snmp['acl_' + acl] %}
  {{ rule.sequence }} {{ rule.text }}
{% endfor %}
{% endfor %}

{% for trap in host.config_context.cisco_snmp_ios.snmp.enable_traps %}
snmp-server enable traps {{ trap }}
{% endfor %}

{% for entry in host.config_context.cisco_snmp_ios.snmp.hosts %}
snmp-server host {{ entry.ip }} version {{ entry.version }} {{
    entry.secret_group is defined and entry.secret_name is defined
    and (host.config_context.secrets_groups
           | selectattr("name","equalto",entry.secret_group)
           | first
           | get_secret_by_secret_group_name(entry.secret_name))
    or entry.community
}}
{% endfor %}
